# frozen_string_literal: true

class Analysis < ApplicationRecord
  def self.get_all_analysis(current_user)
    where(user_id: current_user).order(analysis_date: :desc)
  end

  def self.number_of_analysis(current_user)
    where(user_id: current_user).count
  end

  def self.find_by_user_id(user_id)
    where("user_id = #{user_id}")
  end

  def self.number_of_analysis_completed(current_user)
    where(user_id: current_user).where(is_scan_completed: 1).count
  end

  def self.number_of_analysis_pending(current_user)
    where(user_id: current_user).where(is_scan_completed: 0).count
  end

  def self.detected_flaws(current_user)
    joins("INNER JOIN security_flaws ON security_flaws.analyses_id = analyses.id AND analyses.user_id = #{current_user}").count
  end
end
