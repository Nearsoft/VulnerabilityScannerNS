# frozen_string_literal: true

class DashboardController < ApplicationController
  before_action :authenticate_user!
  Dashboard = Struct.new(:number_of_flaws_type, :type_of_flaws, :detected_flaws, :number_of_analysis, :number_of_analysis_pending, :number_of_analysis_completed, :analyses)

  # TODO: Add scopes
  # TODO Change variables names
  # TODO Use struct
  def index

    m_current_user = current_user.id
    analyses = Analysis.get_all_analysis(m_current_user)
    number_of_analysis = Analysis.number_of_analysis(m_current_user)
    number_of_analysis_completed = Analysis.number_of_analysis_completed(m_current_user)
    number_of_analysis_pending = Analysis.number_of_analysis_pending(m_current_user)
    detected_flaws = Analysis.detected_flaws(m_current_user)

    type_of_flaws = SecurityFlaw.type_of_flaws(m_current_user)

    @number_of_flaws_type = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

    type_of_flaws.each do |typeOfFlaw|
      @number_of_flaws_type[typeOfFlaw.vulnerability_id - 1] = @number_of_flaws_type[typeOfFlaw.vulnerability_id - 1] + 1
    end

    @dashboard = Dashboard.new(@number_of_flaws_type, type_of_flaws, detected_flaws, number_of_analysis, number_of_analysis_pending, number_of_analysis_completed, analyses)
  end
end
