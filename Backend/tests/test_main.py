import unittest

from flask import json

from main import app

data = {
        'url':'http://example.com',
        'idScann':'1',
        'Authentication_Token': 'sjbgvbjknhjbhnhvbbbgjbjk',
        'vulnerabilities': ["blindsqli", "xss"]
        }
bad_data = {
        'url':'http://example.com',
        'Authentication_Token': 'sjbgvbjknhjbhnhvbbbgjbjk',
        'vulnerabilities': ["blindsqli", "xss"]
        }


class MainClassTest(unittest.TestCase):

    def setUp(self):
        self.app = app.test_client()
        self.app.testing = True

    def test_main_hello_world(self):
        result = self.app.get('/')
        print result.get_data()
        self.assertEqual(200, result.status_code)

    def test_main_should_work(self):
        result = self.app.post('/scanner/start',
                               data=json.dumps(data),
                               content_type='application/json')
        print result.get_data()
        print str(result)
        self.assertEqual(200, result.status_code)

    def test_main_should_send_400_if_invalid_json(self):
        result = self.app.post('/scanner/start',
                               data=json.dumps(bad_data),
                               content_type='application/json')
        print result.get_data()
        print str(result)
        self.assertEqual(400, result.status_code)
